<%= content_for :body_id, "dashboard" %>

<div class="menubar">
        <div class="sidebar-toggler visible-xs">
                <i class="ion-navicon"></i>
        </div>

        <div class="page-title">
          <header>
            <h1><a href="/" class="home">EUC Demo Portal</a></h1>
          </header>
        </div>

</div>

<% if current_user %>

<%= render 'profile' %>

<% @current_user_invited = Invitation.where(recipient_username: current_user.username).first %>
<% if !@current_user_invited.blank? && !@current_user_invited.sender.blank? %>
	<br/>
	<h3> Account Details </h3>
	<div class="account details">
           Your account was created by <strong> <%= @current_user_invited.sender.username %> </strong> and their email is <strong> <%= mail_to @current_user_invited.sender.email %> </strong>	
	</div>
<% end %>

<% if policy(current_user).invites? %>
	
       <h3> Account Stats </h3>
	<div class="content-wrapper">
	  <div class="metrics clearfix">
	    <div class="metric">
	      <span class="field">Invitation limit</span>
	      <span class="data">5</span>
	    </div>
	    <div class="metric">
	      <span class="field">Invitations used</span>
	      <span class="data"><%= 5 - current_user.invitation_limit %> </span>
	    </div>
	    <div class="metric">
	      <span class="field">Invitations remaining</span>
	      <span class="data"><%= current_user.invitation_limit %></span>
	    </div>
	  </div>
	</div>

	<div class ="slots">
		<br/>
		<h3> Manage Accounts </h3>
		<table class="table table-striped table-bordered table-condense">
	  <thead>
	    <tr>
	      <th>Full Name</th>
	      <th>Email</th>
	      <th>Company</th>
	      <th>Title</th>
	      <th>Expires on</th>
	      <th>Sender</th>
	      <th colspan="1"></th>
	    </tr>
	  </thead>

	  <tbody>
	    <% @invitations = Invitation.where(sender_id: current_user.id) %>
	    <% @invitations.each do |invitation| %>
	      <tr>
		<td><%= invitation.recipient_firstname + " " + invitation.recipient_lastname %></td>
		<td><%= invitation.recipient_email %></td>
		<td><%= invitation.recipient_company %></td>
		<td><%= invitation.recipient_title %></td>
		<td><%= (invitation.expires_at).to_date.to_formatted_s(:long) %></td>
		<td><%= invitation.sender.username %></td>
		<td class="text-center"><%= link_to 'Expire Account', invitation, method: :delete, data: { confirm: 'Are you sure?' }, class: "new-user btn btn-danger" %></td>
	      </tr>
	    <% end %>
	  </tbody>
	</table>
	<% if current_user.invitation_limit > 0 %>
			<a href="#" data-toggle="modal" data-target="#form-validation-modal" class="new-user btn btn-success pull-left">
				<span>Invite user</span>
			</a>
	<% else %>
			<button type="button" class="btn btn-success" data-dismiss="modal" disabled="true">Invite user</button>
	<% end %>
	</div>
		
	<!-- Form with Validation Modal -->
	<div class="modal fade" id="form-validation-modal" tabindex="-1" role="dialog">
	  	<div class="modal-dialog">
		    <div class="modal-content">
		    	<form id="new-invitation-form" method="post" action="/invitations" role="form">
			      	<div class="modal-header">
			        	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			        	<h4 class="modal-title" id="myModalLabel">
			        		Invite User
			        	</h4>
			      	</div>
			      	<div class="modal-body">
						<input type="hidden" value="<%= form_authenticity_token() %>" name="authenticity_token" %>
						<div class="form-group">
					    	<label>First name:</label>
					    	<input type="text" name="invitation[recipient_firstname]" class="form-control" />
					  	</div>
						<div class="form-group">
					    	<label>Last name:</label>
					    	<input type="text" name="invitation[recipient_lastname]" class="form-control" />
					  	</div>
					  	<div class="form-group">
					    	<label>Email:</label>
					    	<input type="email" name="invitation[recipient_email]" class="form-control" />
					  	</div>
						<div class="form-group">
					    	<label>Company:</label>
					    	<input type="text" name="invitation[recipient_company]" class="form-control" />
					  	</div>
						<div class="form-group">
					    	<label>Title:</label>
					    	<input type="text" name="invitation[recipient_title]" class="form-control" />
					  	</div>
                                <div class="info">
                                  A 30-day account will be setup for the user. After the 30-day trial ends, the user's <strong>account will automatically be deleted from the system.</strong>
                                </div>
			      	</div>
			      	<div class="modal-footer">
				        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				        <button type="submit" class="btn btn-success" id="send-invite" >Send Invite</button>
			      	</div>
				</form>
		    </div>
	  	</div>
	</div>
<% end %>

<% end %>
